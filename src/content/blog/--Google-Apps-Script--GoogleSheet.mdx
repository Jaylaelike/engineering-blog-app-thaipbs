---
heroImage: /src/assets/images/Gs+gas.png
category: Technology
description: การสร้างผู้ช่วยแจ้งเตือนวันที่หมดสัญญาลูกค้า โดยใช้ Google Apps Script
pubDate: 2024-05-23T17:00:00.000Z
tags:
  - กรุงเทพ
  - แจ้งเตือนวันที่หมดสัญญา
  - GoogleSheet
  - Google Apps Script
title: การสร้างผู้ช่วยแจ้งเตือนวันที่หมดสัญญาลูกค้า โดยใช้ Google Apps Script
---

## การสร้างผู้ช่วยแจ้งเตือนวันที่หมดสัญญาลูกค้า โดยใช้ Google Apps Script และ GoogleSheet

สถานที่: ส่วนงานพัฒนานวัตกรรม สำนักวิศวกรรม

เจ้าหน้าที่ผู้สร้างสรรค์งาน: เจ้าหน้าที่ส่วนงานพัฒนานวัตกรรม สำนักวิศวกรรม

ผู้บังคับบัญชา/ที่ปรึกษา: นายประเสริฐ นามเวช หัวหน้าส่วนงานพัฒนานวัตกรรม สำนักวิศวกรรม

นางสาว ธัญษรัศม์ ธัญธรรมพันธ์ หัวหน้าส่วนงานวางแผนและบริการ

วันที่สร้างสรรค์งาน: 25 มีนาคม 2567

อ้างอิง​ : [https://developers.google.com/apps-script/samples](https://developers.google.com/apps-script/samples)

[https://developers.google.com/apps-script/quickstart/custom-functions](https://developers.google.com/apps-script/quickstart/custom-functions)

[https://developers.google.com/apps-script/guides/sheets/functions](https://developers.google.com/apps-script/guides/sheets/functions)

### บทที่มาและความสำคัญของงานพัฒนาระบบแจ้งเตือนการสิ้นสุดสัญญาจาก Google Spreadsheet โดยใช้ LINE Notify API

\*\*บทนำ\*\*

ในปัจจุบันองค์กรต่างๆ ล้วนมีธุรกรรมที่เกี่ยวข้องกับสัญญาจำนวนมาก การติดตามและจัดการสัญญาเหล่านี้อย่างมีประสิทธิภาพจึงมีความสำคัญอย่างยิ่งเพื่อป้องกันความเสียหายทางการเงิน และรักษาความสัมพันธ์ที่ดีกับคู่สัญญา อย่างไรก็ตาม การติดตามสัญญาด้วยวิธีดั้งเดิม เช่น การจดบันทึกด้วยตนเอง มักมีความยุ่งยาก ผิดพลาดง่าย และใช้เวลานาน

### \*\*ปัญหา\*\*

ปัจจุบันยังไม่มีระบบแจ้งเตือนการสิ้นสุดสัญญาที่สะดวก รวดเร็ว และแม่นยำ สำหรับผู้ใช้งานทั่วไป โดยเฉพาะผู้ใช้งานที่ไม่คุ้นเคยกับการเขียนโปรแกรม ระบบที่มีอยู่ส่วนใหญ่ มักเป็นระบบที่ซับซ้อน ใช้งานยาก หรือมีค่าใช้จ่ายสูง

### วัตถุประสงค์

งานวิจัยนี้มุ่งหวังพัฒนาระบบแจ้งเตือนการสิ้นสุดสัญญาจาก Google Spreadsheet โดยใช้ LINE Notify API เพื่อช่วยให้องค์กรต่างๆ ติดตามและจัดการสัญญาได้อย่างมีประสิทธิภาพ โดยระบบนี้มีคุณสมบัติ ดังนี้

\- \*\*ใช้งานง่าย:\*\* ผู้ใช้งานทั่วไปสามารถใช้งานระบบได้โดยไม่ต้องมีความรู้ด้านการเขียนโปรแกรม

\- \*\*รวดเร็ว:\*\* ระบบสามารถแจ้งเตือนการสิ้นสุดสัญญาล่วงหน้าได้ทันเวลา

\- \*\*แม่นยำ:\*\* ระบบสามารถดึงข้อมูลจาก Google Spreadsheet โดยตรง จึงลดความเสี่ยงต่อการเกิดข้อผิดพลาด

\- \*\*สะดวก:\*\* ผู้ใช้งานสามารถรับการแจ้งเตือนผ่าน LINE Notify ซึ่งเป็นแอปพลิเคชันยอดนิยมที่ใช้งานง่าย

### \*\*ความสำคัญ\*\*

ระบบแจ้งเตือนการสิ้นสุดสัญญามีความสำคัญต่อองค์กรต่างๆ ดังนี้

\- \*\*ช่วยป้องกันความเสียหายทางการเงิน:\*\* การแจ้งเตือนล่วงหน้าช่วยให้องค์กรสามารถเตรียมพร้อมสำหรับการต่ออายุสัญญา หรือหาสัญญาใหม่ทดแทน ซึ่งช่วยป้องกันความเสียหายทางการเงินที่อาจเกิดขึ้นจากการสูญเสียโอกาสทางธุรกิจ หรือการถูกเรียกร้องค่าเสียหาย

\- \*\*รักษาความสัมพันธ์ที่ดีกับคู่สัญญา:\*\* การแจ้งเตือนล่วงหน้าแสดงให้เห็นถึงความเอาใจใส่ และความรับผิดชอบขององค์กร ซึ่งช่วยสร้างความประทับใจให้กับคู่สัญญา และรักษาความสัมพันธ์ที่ดี

\- \*\*เพิ่มประสิทธิภาพการทำงาน:\*\* ระบบแจ้งเตือนช่วยลดภาระงานของพนักงาน โดยไม่ต้องคอยติดตามและตรวจสอบสัญญาด้วยตนเอง ซึ่งช่วยให้พนักงานสามารถทำงานอื่นๆ ได้อย่างมีประสิทธิภาพมากขึ้น

### \*\*ผลลัพธ์ที่คาดหวัง\*\*

คาดว่าระบบแจ้งเตือนการสิ้นสุดสัญญาจาก Google Spreadsheet โดยใช้ LINE Notify API จะช่วยให้องค์กรต่างๆ ติดตามและจัดการสัญญาได้อย่างมีประสิทธิภาพ โดยระบบนี้สามารถช่วยป้องกันความเสียหายทางการเงิน รักษาความสัมพันธ์ที่ดีกับคู่สัญญา และเพิ่มประสิทธิภาพการทำงาน

### \*\*ข้อจำกัด\*\*

ระบบนี้มีข้อจำกัด ดังนี้

\- \*\*ระบบจะแจ้งเตือนเฉพาะสัญญาที่มีข้อมูลวันที่สิ้นสุดสัญญาใน Google Spreadsheet เท่านั้น\*\*

\- \*\*ผู้ใช้งานต้องมีบัญชี LINE เพื่อรับการแจ้งเตือน\*\*

### \*\*แนวทางการพัฒนาต่อไป\*\*

ในอนาคต มีแผนพัฒนาต่อระบบนี้ ดังนี้

\- \*\*พัฒนาระบบให้รองรับการแจ้งเตือนผ่านช่องทางอื่นๆ เพิ่มเติม\*\* เช่น อีเมล หรือ SMS

\- \*\*พัฒนาระบบให้รองรับการแจ้งเตือนแบบกำหนดเอง\*\* เช่น แจ้งเตือนล่วงหน้ากี่วัน หรือแจ้งเตือนเฉพาะสัญญาสำคัญ

\- \*\*พัฒนาระบบให้รองรับการดึงข้อมูลจากแหล่งข้อมูลอื่นๆ เพิ่มเติม\*\* เช่น ระบบ CRM

\- Apps Script เป็นแพลตฟอร์มเดียวที่แทบไม่ต้องใช้การเขียนโค้ดซึ่งใช้สร้างโซลูชันทางธุรกิจที่ใช้งานร่วมกับ Google Workspace รวมทั้งขยายฟังก์ชันการทำงาน และปรับให้เป็นระบบอัตโนมัติได้อย่างง่ายดายและรวดเร็ว เมื่อใช้ Apps Script ผู้ใช้แบบธุรกิจจะสร้างโซลูชันที่กำหนดเองเพิ่มเติมจากการใช้ Google Workspace แบบปกติได้โดยไม่จำเป็นต้องมีทักษะการพัฒนาซอฟต์แวร์มืออาชีพแต่อย่างใด ผู้ใช้ทุกคนที่มีบัญชี Gmail จะใช้ Apps Script ได้

### \*\*ความสามารถเด่นๆ\*\* ของ Google Apps Script:

\- \*\*สร้างระบบอัตโนมัติ:\*\* เขียนสคริปต์เพื่อทำงานที่ซ้ำๆ ภายในแอปของ Google Workspace เช่น Sheets, Docs, Gmail และ Calendar ช่วยให้คุณประหยัดเวลาและแรงงาน

\- \*\*ฟังก์ชันกำหนดเอง:\*\* สร้างฟังก์ชันพิเศษเพื่อเพิ่มประสิทธิภาพให้กับ Google Sheets คุณสามารถใช้ฟังก์ชันเหล่านี้ภายในสเปรดชีทได้เหมือนฟังก์ชันสำเร็จรูปทั่วไป

\- \*\*ส่วนเสริม:\*\* พัฒนาส่วนเสริม (add-on) เพื่อเพิ่มคุณสมบัติใหม่ๆ ให้กับแอปพลิเคชันใน Google Workspace คุณสามารถใช้ส่วนเสริมเหล่านี้

### ออกแบบโฟลว์การทำงานทั้งหมดของระบบ

![](https://raw.githubusercontent.com/Jaylaelike/engineering-blog-app-thaipbs/main/src/assets/images/Email-and-Line-alertmassagesGoogleScript.png)

ระบบนี้ทำงานโดยใช้ Google Sheets เป็นฐานข้อมูล และใช้ Google Apps Script ในการทริกเกอร์เหตุการณ์ตามวันที่และเวลาที่กำหนดไว้ ดังนี้

\*\*1. ดึงข้อมูลจาก Google Sheets\*\*

ระบบจะเริ่มต้นด้วยการดึงข้อมูลจาก Google Sheets ข้อมูลนี้อาจจะเป็นข้อมูลอะไรก็ได้ เช่น รายชื่อลูกค้า รายการนัดหมาย หรือข้อมูลอื่นๆ ที่ต้องการใช้ในระบบ

\*\*2. ทริกเกอร์เหตุการณ์ตามวันที่และเวลา\*\*

ระบบจะใช้ Google Apps Script ในการทริกเกอร์เหตุการณ์ตามวันที่และเวลาที่กำหนดไว้ ตัวอย่างเช่น ระบบอาจจะส่งอีเมลแจ้งเตือนลูกค้า 1 วันก่อนถึงนัดหมาย

\*\*3. ดำเนินการตามขั้นตอนของฟังก์ชัน\*\*

เมื่อเหตุการณ์ถูกทริกเกอร์ ระบบจะดำเนินการตามขั้นตอนของฟังก์ชันที่กำหนดไว้ ขั้นตอนเหล่านี้อาจจะเป็นอะไรก็ได้ เช่น การส่งอีเมล การอัปเดตฐานข้อมูล หรือการสร้างรายงาน

\*\*4. แจ้งเตือนผ่านอีเมลและ Line\*\*

ในขั้นตอนสุดท้าย ระบบอาจจะแจ้งเตือนผู้ใช้ผ่านอีเมลหรือ Line ขึ้นอยู่กับการตั้งค่าของระบบ

### ขั้นตอนการเตรียมข้อมูล และ สร้าง App Script ที่ใช้ในการแจ้งเตือน

1. เตรียมข้อมูลให้ได้ดังรูป ประกอบไปด้วย datetime ต้องมีประเภทข้อมูลเป็น DATETIME()

![](https://raw.githubusercontent.com/Jaylaelike/engineering-blog-app-thaipbs/main/src/assets/images/Screenshot-2567-04-25-at-11.12.09.png)

2.ไปที่เมนู ส่วนขยาย และไปที่ >> เมนู App Script >> เพื่อนำโค้ดโปรแกรมที่ได้ไป deployed

![](https://raw.githubusercontent.com/Jaylaelike/engineering-blog-app-thaipbs/main/src/assets/images/Screenshot-2567-04-25-at-11.35.13.png)

1. เพื่อนำโค้ดโปรแกรมที่ได้ไปวางไว้ที่ รหัส.gs จากนั้นกดปุ่ม บันทึกการทำงาน เป็นอันเสร็จเรียบร้อยในการเตรียม Script ในส่วนของโปรแกรมหลัก

![](https://raw.githubusercontent.com/Jaylaelike/engineering-blog-app-thaipbs/main/src/assets/images/Screenshot-2567-04-25-at-11.02.16.png)

### อธิบายการทำงานของโค้ด

โค้ดนี้ประกอบด้วยฟังก์ชันหลายฟังก์ชันที่ทำงานร่วมกันเพื่อตรวจสอบวันที่ในสเปรดชีทและส่งการแจ้งเตือนทางอีเมลหรือ Line Notify เมื่อพบวันที่ที่ตรงกับวันปัจจุบัน ซึ่งมีรายละเอียดการทำงานดังนี้

1\. \`checkCountNotify()\`

\- ฟังก์ชันนี้จะวนลูปผ่านเซลล์ทั้งหมดในสเปรดชีทปัจจุบัน

\- ตรวจสอบวันที่ในแต่ละเซลล์โดยนำมาเปรียบเทียบกับวันปัจจุบัน (เวลาถูกตัดทิ้ง)

\- นับจำนวนเซลล์ที่มีวันที่ตรงกับวันปัจจุบัน

\- แสดงจำนวนวันที่ที่ตรงกับวันปัจจุบันในบันทึกของ Logger

\- เรียกฟังก์ชัน \`sendCountNotify()\` พร้อมส่งจำนวนวันที่ที่ตรงกับวันปัจจุบัน

![](https://raw.githubusercontent.com/Jaylaelike/engineering-blog-app-thaipbs/main/src/assets/images/checkCountNotify.png)

2\. \`sendCountNotify()\`

\- ฟังก์ชันนี้จะรับพารามิเตอร์ที่เป็นจำนวนวันที่ที่ตรงกับวันปัจจุบัน

\- สร้างข้อความแจ้งเตือนโดยใช้จำนวนวันที่ที่ได้รับมา

\- ส่งข้อความแจ้งเตือนไปยัง Line Notify ผ่าน API ของ Line Notify

![](https://raw.githubusercontent.com/Jaylaelike/engineering-blog-app-thaipbs/main/src/assets/images/sendCountNotify.png)

3\. \`checkDateTimeAndNotify()\`

\- เข้าถึงสเปรดชีทที่ใช้งานอยู่

\- วนลูปผ่านแถวทั้งหมดในสเปรดชีท

\- ตรวจสอบวันที่ในแต่ละแถวโดยนำมาเปรียบเทียบกับวันปัจจุบัน (เวลาถูกตัดทิ้ง)

\- สำหรับแถวที่มีวันที่ตรงกับวันปัจจุบัน จะเรียกฟังก์ชัน \`getMatchingRowData()\` เพื่อรับข้อมูลจากแถวนั้น

\- สร้างข้อความแจ้งเตือนจากข้อมูลที่ได้รับมา โดยใช้รูปแบบ HTML

\- เพิ่มข้อความแจ้งเตือนลงในรายการ \`messageList\`

\- นับจำนวนข้อความแจ้งเตือนที่เพิ่มลงในรายการ

\- หลังจากวนลูปเสร็จสิ้น จะตรวจสอบว่ามีข้อความแจ้งเตือนหรือไม่

\- ถ้ามีข้อความแจ้งเตือน จะรวมข้อความทั้งหมดเข้าด้วยกัน โดยแสดงจำนวนสัญญาที่จะสิ้นสุดในวันนี้ด้วย

\- เรียกฟังก์ชัน \`prepareEmailWithLogos()\` เพื่อเตรียมข้อความสำหรับส่งอีเมล โดยมีโลโก้แสดงอยู่ด้วย

\- เรียกฟังก์ชัน \`sendEmail()\` เพื่อส่งอีเมลแจ้งเตือน

\- วนลูปผ่านแถวอีกครั้ง เพื่อส่งข้อความแจ้งเตือนไปยัง Line Notify สำหรับแต่ละแถวที่มีวันที่ตรงกับวันปัจจุบัน

![](https://raw.githubusercontent.com/Jaylaelike/engineering-blog-app-thaipbs/main/src/assets/images/checkDateTimeAndNotify.png)

4\. \`getMatchingRowData(rowIndex)\`

\- ฟังก์ชันนี้จะรับพารามิเตอร์ที่เป็นอินเดกซ์ของแถว

\- คืนค่าเป็นอาร์เรย์ที่ประกอบด้วยข้อมูลจากคอลัมน์ B และ C ของแถวนั้น

![](https://raw.githubusercontent.com/Jaylaelike/engineering-blog-app-thaipbs/main/src/assets/images/getMatchingRowData.png)

5\. \`sendLineNotify(message)\`

\- ฟังก์ชันนี้จะรับพารามิเตอร์ที่เป็นข้อความที่ต้องการส่ง

\- ส่งข้อความไปยัง Line Notify ผ่าน API ของ Line Notify

![](https://raw.githubusercontent.com/Jaylaelike/engineering-blog-app-thaipbs/main/src/assets/images/sendLineNotify.png)

6\. \`prepareEmailWithLogos(message)\`

\- ฟังก์ชันนี้จะรับพารามิเตอร์ที่เป็นข้อความสำหรับอีเมล

\- ดึงภาพโลโก้จาก URL และแปลงเป็น Blob

\- สร้างข้อความ HTML สำหรับอีเมล โดยมีภาพโลโก้แสดงอยู่ด้วย

\- คืนค่าเป็นวัตถุที่มีคีย์ \`htmlBody\` และ \`inlineImages\` ซึ่งจะใช้ในการส่งอีเมล

![](https://raw.githubusercontent.com/Jaylaelike/engineering-blog-app-thaipbs/main/src/assets/images/prepareEmailWithLogos.png)

7\. \`sendEmail(emailData)\`

\- ฟังก์ชันนี้จะรับพารามิเตอร์ที่เป็นวัตถุที่มีคีย์ \`htmlBody\` และ \`inlineImages\`

\- ส่งอีเมลไปยังที่อยู่อีเมลที่กำหนด โดยใช้ข้อความ HTML และภาพโลโก้ที่ได้รับมา

\- สามารถกำหนด email ที่ต้องการส่งหลายๆ account ตรงส่วนของ \`\`\` to: [examples@gmail.com](mailto:examples@gmail.com)\`\`\`

![](https://raw.githubusercontent.com/Jaylaelike/engineering-blog-app-thaipbs/main/src/assets/images/sendEmail.png)

โค้ดนี้จะตรวจสอบวันที่ในสเปรดชีทและส่งการแจ้งเตือนทางอีเมลและ Line Notify เมื่อพบวันที่ที่ตรงกับวันปัจจุบัน โดยการแจ้งเตือนทางอีเมลจะมีโลโก้แสดงอยู่ด้วย

### ขั้นตอนการตั้งค่าทริกเกอร์เพื่อให้ฟังก์ชั้นทำงานตามช่วงเวลาที่ต้องการแจ้งเตือน

1\. ไปที่เมนู Trigger ทริกเกอร์ และ เลือกเพิ่มทริกเกอร์ ที่ปุ่มมุมขวาล่าง

![](https://raw.githubusercontent.com/Jaylaelike/engineering-blog-app-thaipbs/main/src/assets/images/Screenshot-2567-04-25-at-11.38.06.png)

2\. จากนั้นเลือกเมนู ฟังก์ชั่นที่เรียกใช้งานในที่นี่เลือกเป็นฟังก์ชั่นหลักคือ \`checkCountNotify()\` เสร็จแล้วไปเลือก ประเภทของการทริกเกอร์ ตามเวบาที่ต้องการได้เลยตามรูป จากนั้นกดบันทึก ทริกเกอร์เป็นอันเสร็จเรียบร้อย

![](https://raw.githubusercontent.com/Jaylaelike/engineering-blog-app-thaipbs/main/src/assets/images/Screenshot-2567-04-25-at-11.37.55.png)

### ผลลัพธ์ของการส่งข้อความแจ้งเตือน

![](https://raw.githubusercontent.com/Jaylaelike/engineering-blog-app-thaipbs/main/src/assets/images/Screenshot-2567-04-25-at-10.18.20.png)

![](<https://raw.githubusercontent.com/Jaylaelike/engineering-blog-app-thaipbs/main/src/assets/images/Untitled-design-(1)-1.png>)

![](<https://raw.githubusercontent.com/Jaylaelike/engineering-blog-app-thaipbs/main/src/assets/images/Untitled-design-(2).png>)
